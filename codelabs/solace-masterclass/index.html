
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Solace Masterclass</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14" ga4id=""></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  codelab-ga4id=""
                  id="solace-masterclass"
                  title="Solace Masterclass"
                  environment="web"
                  feedback-link="https://github.com/SolaceDev/solace-dev-codelabs/blob/master/markdown/solace-masterclass">
    
      <google-codelab-step label="What you&#39;ll learn: Overview" duration="1">
        <p class="image-container"><img alt="Solace Masterclass" src="img/b2ffae1eb8e18d25.jpeg"></p>
<p>This Codelab contains the technical hands-on section of the <strong>Solace Masterclass: Implementing Event-Driven-Architectures</strong> Participants of this masterclass will be implementing this Codelab in a Github Codespace environment provided as a part of the masterclass session. The codespace contains all the software packages required for implementing the hands-on Codelab.</p>
<p>The agenda of the hands-on is as below :</p>
<ul>
<li>Use case introduction</li>
<li>Cloud account and broker setup</li>
<li>Event Portal design import</li>
<li>Application development and testing: <ul>
<li>Explore the selected use case and understand the interactions between applications and events</li>
<li>Implement each application with business code logic as described in the Codelab</li>
<li>Test the end to end event flow</li>
</ul>
</li>
<li>Understand the benefits of EDA and Solace in these use cases</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Use case introduction" duration="1">
        <p>As a part of the event storming session earlier you would have discussed and brainstormed on few use cases. In this brainstorming you have identified systems, events and processes involved in the flow(s) and also designed the topic taxonomy following Solace best practices and recommendations.</p>
<p>In the hands-on section of this masterclass, you can choose one of the below industry domains :</p>
<ol type="1">
<li>Retail</li>
<li>Banking</li>
</ol>
<p>and follow it for implementing. Due to time limit considerations, we will be implementing only a selected subset of the whole design.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Solace Cloud Account and broker provisioning" duration="0">
        <h2 is-upgraded>Solace Cloud Account</h2>
<p>In case you do not have an active Solace cloud account, you can register for one via the link: <a href="https://console.solace.cloud/login/new-account?product=event-streaming" target="_blank">Solace trial account registration</a>.<br> You can log in to the newly created Solace cloud account using the link : <a href="https://console.solace.cloud/home?login=true" target="_blank">Solace Cloud Account Login</a>. Once you have registered and logged in to the Solace cloud account, you can get started with provisioning a Solace developer grade broker which will be used in the next sections.</p>
<h2 is-upgraded>Provision Your First Solace PubSub Broker</h2>
<h3 is-upgraded>Navigate to Cluster Manager</h3>
<ol type="1">
<li>In the Solace Cloud Console, click <strong>Cluster Manager</strong> in the left navigation <img alt="broker-setup-1.png" src="img/58ef0b648d73d459.png"></li>
<li>Click <strong>Create Service</strong> (or the <strong>+</strong> button if you have existing services) <img alt="broker-setup-2.png" src="img/d187420aeba7e27a.png"></li>
</ol>
<h3 is-upgraded>Configure Your Service</h3>
<ol type="1">
<li>Fill in the service configuration details:</li>
</ol>
<ul>
<li>Name : Choose a concise name (e.g., <code>solace-masterclass</code>)</li>
<li>Environment : Leave as <strong>Default</strong></li>
<li>Cloud : Choose your preferred cloud provider (AWS, Azure, or GCP)</li>
<li>Region : Select a region closest to your location</li>
<li>Broker Release : Leave as default (latest stable)</li>
<li>Service Type : Select <strong>Developer</strong> (free tier) <img alt="broker-setup-3.png" src="img/a5ac69ec9cec6df.png"></li>
</ul>
<ol type="1" start="2">
<li>Click <strong>Create Service</strong></li>
</ol>
<h3 is-upgraded>Wait for Provisioning</h3>
<ol type="1">
<li>The service will take 3-5 minutes to provision</li>
<li>Status will show as <strong>Creating...</strong><img alt="broker-setup-4.png" src="img/ed2f31fedc0c8359.png"></li>
<li>Once complete, the broker details page will load <img alt="broker-setup-5.png" src="img/6f018e2b8d9a22ac.png"></li>
</ol>
<h3 is-upgraded>Explore Your Broker</h3>
<ol type="1">
<li>Navigate through the tabs:</li>
</ol>
<ul>
<li><strong>Connect</strong>: Connection details and credentials <img alt="broker-connect-tab.png" src="img/f3d7986db71045f7.png"></li>
<li><strong>Manage</strong>: Service management and configuration <img alt="broker-manage-tab.png" src="img/a55e7ed38a844642.png"></li>
</ul>
<aside class="special"><p><strong>Checkpoint</strong>: You should now have a running PubSub+ broker service with status &#34;Running&#34; in your Cluster Manager.</p>
</aside>
<h2 is-upgraded>Configure environment and modelled event mesh</h2>
<h3 is-upgraded>Environment Setup</h3>
<p>Environments in Solace Cloud represent the runtime environments within your organisation. For example, you may have</p>
<ul>
<li>Multiple development environments</li>
<li>Multiple testing environments</li>
<li>A Staging or Pre-Production</li>
<li>A Production environment</li>
</ul>
<ol type="1">
<li>In the Solace Cloud Console, navigate to the <strong>Environments</strong> tab <img alt="env-setup-1.png" src="img/6b674b558726f62.png"></li>
<li>In the <strong>Environments</strong> tab, there is a default environment created for you called &#34;Default&#34; <img alt="env-setup-2.png" src="img/c1f2f7ff450e022e.png"></li>
<li>Click on the <strong>...</strong> buttons next to the Default environment and select <strong>Runtime Configuration Settings</strong><img alt="env-setup-3.png" src="img/5e5ab58e9bb4c7cb.png"></li>
<li>Click on the <strong>Auto on Promotion</strong> radio button to enable automatic promotion of configuration changes from Event Portal to the associated PubSub+ Cloud broker <img alt="env-setup-4.png" src="img/983158dd78ebafaf.png"></li>
<li>Click <strong>Save</strong> to save the changes</li>
<li>Optional: You can edit some of the environment details like name and description by clicking on the <strong>Edit</strong> button under the <strong>...</strong> menu <img alt="env-setup-optional.png" src="img/7ffc7a5f08e72f75.png"></li>
</ol>
<h3 is-upgraded>Modeled Event Mesh Setup</h3>
<p>A modeled event mesh represents an actual event mesh or event flow operating in a specific runtime environment. Modeled event meshes help you define and visualise event flows between publishing and subscribing applications within your event-driven architecture (EDA).</p>
<ol type="1">
<li>In the Solace Cloud Console, navigate to the <strong>Runtime Event Manager</strong> tab <img alt="mem-setup-1.png" src="img/302bae2dd7e550b0.png"></li>
<li>Click on the <strong>Create Modeled Event Mesh</strong> button <img alt="mem-setup-2.png" src="img/47bec09f34f04cd3.png"></li>
<li>Fill in the details for the modeled event mesh:</li>
</ol>
<ul>
<li>Name : <code>Dev-Mesh</code></li>
<li>Type : <code>Solace</code></li>
<li>Description : <code>Development Modeled Event Mesh</code></li>
<li>Environment : Select <code>Default</code> environment</li>
</ul>
<ol type="1" start="4">
<li>Click <strong>Create</strong> to create the modeled event mesh <img alt="mem-setup-3.png" src="img/ed55433de9edddd2.png"></li>
<li>You will see the newly created modeled event mesh in the list <img alt="mem-setup-4.png" src="img/ffc6d4e4c909a1d9.png"></li>
<li>Click on the modeled event mesh name to view its details</li>
<li>Under the <strong>Event Broker Connections</strong> tab, click on <strong>Connect Event Broker</strong><img alt="mem-setup-5.png" src="img/b5b5d1272be2000.png"></li>
<li>Select the PubSub+ Cloud broker you created earlier (e.g., <code>ep-codelab</code>) and click <strong>Add</strong><img alt="mem-setup-6.png" src="img/49abf58eedec5a0f.png"></li>
<li>You should now see the broker connection listed under the <strong>Event Broker Connections</strong> tab <img alt="mem-setup-7.png" src="img/a7811a7e811023dc.png"></li>
</ol>
<aside class="special"><p><strong>Checkpoint</strong>: You should now have an environment configured with automatic promotion enabled and a modeled event mesh connected to your PubSub+ Cloud broker.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Event Portal design" duration="10">
        <p>The Event Portal is a cloud-based tool that simplifies the design of your event-driven architecture (EDA). With the Event Portal, you can:</p>
<ul>
<li>Define and track relationships between applications in a highly decoupled EDA.</li>
<li>Create and manage events using a user-friendly GUI. In summary, the Event Portal streamlines event management, making it an essential part of your EDA toolkit.</li>
</ul>
<h2 is-upgraded>Step 1 : Import Event Portal designs</h2>
<ul>
<li>From the Solace cloud account screen, click on the <strong>Designer</strong> button and enter the Event Portal&#39;s Designer page as below : <img alt="ep-designer-button.png" src="img/cd1491ecb79cf14c.png"></li>
<li>Based on the choice of your domain, you can select one of the two domain files as below and download it from the links :<br> - Banking Industry : <a href="https://github.com/SolaceLabs/solace-masterclass-code/blob/main/ep-app-domains/Acme_Bank_App_Domain.json" target="_blank">Download Banking Industry App Domain File</a><br> - Retail industry : <a href="https://github.com/SolaceLabs/solace-masterclass-code/blob/main/ep-app-domains/Acme_Retail_App_Domain.json" target="_blank">Download Retail Industry App Domain File</a></li>
<li>Click on the <strong>Import Application Domains</strong> button by clicking on the three dots in the top right corner as below : <img alt="ep-app-domain-import.png" src="img/80d2fa6931ed06de.png"></li>
<li>A file selector dialog box will be displayed so that you can select the application domain file of your choice.</li>
<li>Select on a file and click  <strong>Open</strong>, this will result in the application domain being imported as below : <img alt="ep-app-domain-imported.png" src="img/77cfd424d87d6acf.png"></li>
</ul>
<aside class="special"><p> you can import as many application domains as you wish, but for time considerations it&#39;s advisable to choose one example for implementation.</p>
</aside>
<aside class="warning"><p> Please note that the initial visualisation of the application domain might be a bit different from the screenshot. You can rearrange the objects as per your preference and save the layout for easier navigation in the future.</p>
</aside>
<ul>
<li>Inside the application domain, you should be able to see the objects from your selected industry as below :<ul>
<li>Retail industry : <img alt="retail-domain-ep.png" src="img/9d1a9d510636d717.png"></li>
<li>Banking industry : <img alt="banking-industry.png" src="img/3958ef256b43aeca.png"></li>
</ul>
</li>
<li>Explore the various EDA artifacts like schemas, events, applications, their relationships and dependencies.</li>
</ul>
<aside class="special"><p> This is an interesting step from an architecture perspective as the Event Portal is a unique tool which helps you visualize the state of your EDA landscape, identify dependencies and versions, etc.</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Use case implementation" duration="10">
        <p>For the hands-on excercise, we will be using GitHub Codespaces which provides a cloud-based development environment with all the necessary tools and software pre-installed.</p>
<h2 is-upgraded>Setup GitHub Codespace</h2>
<aside class="warning"><p> Please note that using GitHub Codespace requires a GitHub account.<br> If you do not have a GitHub account, you can create one for free by visiting <a href="https://github.com/signup" target="_blank">GitHub Sign Up</a><br> If your enterprise GitHub account does not have access to GitHub Codespaces, you can use a personal GitHub account to access the Codespaces environment for this workshop.</p>
</aside>
<h3 is-upgraded>Step 1: <strong>Open the Workshop Repository</strong></h3>
<p>Visit <a href="https://github.com/SolaceDev/solace-developer-workshops/" target="_blank">Solace Developer Workshops</a><img alt="020-github-workshop-repo.png" src="img/d1c25542dbb54053.png"></p>
<h3 is-upgraded>Step 2: Click <strong>Open in GitHub Codespaces</strong></h3>
<p class="image-container"><img alt="020-open-github-codespaces.png" src="img/c8b3db6c2efe7f3a.png"></p>
<h3 is-upgraded>Step 3: Choose <strong>Change Options</strong> → set machine type to <strong>4-core</strong></h3>
<p class="image-container"><img alt="020-codepsaces-change-options.png" src="img/60d647967310b081.png"></p>
<h3 is-upgraded>Step 4: Click <strong>Create Codespace</strong></h3>
<p class="image-container"><img alt="020-codespace-ready.png" src="img/9e58b434ac348897.png"></p>
<aside class="warning"><p> Please note that the codespace may take a few minutes to initialise. You will see some logs in the terminal during the initialization process. Once the setup is complete, you will have a ready-to-use development environment in the cloud.</p>
</aside>
<h2 is-upgraded>Use case selection</h2>
<p>Based on use case of your choice, please follow the appropriate chapter below :</p>
<ul>
<li>Retail: Sections 6 and 7</li>
<li>Banking: Sections 8 and 9</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Part-A : Retail Domain" duration="45">
        <h2 is-upgraded>Use case explanation</h2>
<p>For the retail domain use case, we will be considering a fictitious company called Acme Retail which has been consistently recognized as the leader in Ecommerce website. Unfortunately, due to legacy and outdated architecture choices and implementation, Acme Retail is encountering major challenges in expanding their operations as below :</p>
<ul>
<li>Order processing errors</li>
<li>Inventory management issues</li>
<li>Fraudulent orders</li>
</ul>
<p>This has impacted their customer&#39;s experience, and they are at risk of losing their customers. As a solution, they have defined a POC to event enable the Order-to-Cash (OTC) flow.</p>
<p>The dependency between the applications and events are described as below :</p>
<ul>
<li>User orders via <strong>Order service</strong></li>
<li><strong>Order service</strong> publishes <em>Order-Created</em> event</li>
<li><strong>Inventory-Fraud-Service</strong> subscribes to <em>Order-Created</em>, reserves stock and conducts fraud check</li>
<li><strong>Inventory-Fraud-Service</strong>: <ul>
<li>Publishes <em>Order-Confirmed</em> event</li>
<li><strong>Order service</strong> subscribes to <em>Order-Confirmed</em> event for user status updates</li>
</ul>
</li>
<li><strong>Payment service</strong> subscribes to <em>Order-Confirmed</em> event and integrates with PSP/Gateway for payment transaction processing</li>
<li><strong>Payment service</strong><ul>
<li>Publishes <em>Payment Created</em> event</li>
<li>Publishes <em>Payment Updated</em> event</li>
<li><strong>Order service</strong> subscribes to the <em>Payment Created</em> event for user updates</li>
</ul>
</li>
<li><strong>Shipping service</strong> subscribes to <em>Payment Created</em> integrates with 3PL or the logistics provider</li>
<li><strong>Shipping service</strong>: <ul>
<li>Publishes <em>Shipment created</em> event</li>
<li>Publishes <em>Shipment updated</em> event</li>
<li><strong>Order service</strong> subscribes to the <em>Shipment created</em> for user updates</li>
</ul>
</li>
</ul>
<p class="image-container"><img alt="retail-domain-usecase.png" src="img/d1f337cc85ee4073.png"></p>
<p>This POC leverages the following architectural principles and practices :</p>
<ul>
<li><strong>Microservices Architecture</strong>: The system is broken down into smaller, independent services that communicate with each other through messages. This makes the system more scalable, resilient, and easier to maintain.</li>
<li><strong>Event-Driven Architecture</strong>: Events are used to trigger actions in different parts of the system. For example, placing an order triggers an event is subscribed by multiple interested consumers. This makes the system more flexible and responsive to changes.</li>
<li><strong>Publish-Subscribe Pattern</strong>: Services publish events to a central message broker, and other services can subscribe to those events. This allows for loose coupling between services, as they don&#39;t need to know about each other directly.</li>
</ul>
<p>As a part of the workshop, you will have access to prebuilt applications and artifacts which you will be using in this segment of the workshop.</p>
<h2 is-upgraded>1. Order Service</h2>
<h3 is-upgraded>Introduction</h3>
<p>The Order-Service acts as the entry point to the whole flow and emulates the user experience of creating a basket and converting it into an Order. As described earlier in the over-all flow definition, it creates the <em>Order-Created</em> events and subscribes to other relevant events which it uses for showing realtime status updates on the order level.</p>
<h3 is-upgraded>How to run ?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Click on the <strong>Designer</strong> button and enter the Designer screen where you should be able to see the newly imported Application Domain. <img alt="designer-app-domain-imported.png" src="img/c2c286b983caacd0.png"></li>
<li>Click on the <strong>Acme Retail</strong> application domain, where you can visualise the events, applications and their interactions as below : <img alt="formatted-app-domain.png" src="img/16ce70c3a9b71c83.png"></li>
</ul>
<aside class="special"><p> Do note that the first time visualization of the events and their interactions might differ from what you see in the screenshot.<br> You can reorder the objects as per your preference</p>
</aside>
<ul>
<li>Click on the <strong>Order Service</strong>, and then on the <strong>Open Application</strong> which pops up as below : <img alt="edit-order-service-1.png" src="img/75e3a02b9911cb6f.png"></li>
<li>The <strong>Order Service</strong> application screen displays you the various events that are published and subscribed by this version of the application : <img alt="editing-order-service-1.png" src="img/dff1fffc96783ac8.png"></li>
<li>Click on the <strong>Configurations</strong> tab on the left sidebar as below : <img alt="configuring-order-service-1.png" src="img/c7cb12156cd1d4c.png"></li>
<li>This opens up the configuration screen, click on the <strong>Create Configurations</strong> button as shown: <img alt="order-service-create-configuration.png" src="img/22f3494c4669ba3a.png"></li>
<li>A modal window opens up as below, first select the environment and the broker that you have created earlier and click on the <strong>Next:Define Event Handling</strong> button : <img alt="order-service-select-env-broker.png" src="img/c5c566d737c63457.png"></li>
<li>For now, we are not configuring any consumers (or subscriptions) for this application, so click on the <strong>Next: Define Access Control</strong> button directly. <img alt="order-service-define-event-handling.png" src="img/ab62e788eb913cd8.png"></li>
<li>For authentication, select the <strong>Basic</strong> access type and enter a client usename and password of your choice as below. <strong>Make sure to keep a note of these credentials as they will be required in the following steps.</strong><img alt="order-service-access-control.png" src="img/44dda125c0ad3a3d.png"></li>
<li>Review the configuration in both the <strong>Define Event Handling</strong> and <strong>Define Access Control</strong> tabs and if everything looks as expected, click <strong>Start Promotion</strong> as below : <img alt="order-service-start-promotion.png" src="img/81ed173f57ac87fd.png"></li>
<li>An intermediate screen is shown as below indicating some design mismatches, but you can safely ignore them for now and click on the <strong>Preview Promotion</strong> button as below : <img alt="order-service-design-mismatches.png" src="img/ca634659448cc42b.png"></li>
<li>The final promotion preview is shown as below, detailing the various configuration objects that will be created on the broker. Click on the <strong>Promote</strong> button as shown : <img alt="order-service-final-promotion-preview.png" src="img/2f8772b46592689.png"></li>
<li>Once the deployment is completed, you can see the deployed application version on the broker as below : <img alt="order-service-creds-deployed.png" src="img/fca48aae0810ab2a.png"></li>
</ul>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>In the codespace terminal, create a new terminal window by clicking on the <strong>+</strong> icon on the terminal pane</li>
<li>Navigate to the directory: <strong>solace-masterclass/retail-domain/order-service</strong></li>
<li>Run the command : <code>mvn clean spring-boot:run</code></li>
<li>Once the application is up and running, open the application using the url that is shown in the popup within the codespace.</li>
<li>You should see a page which looks like this : <img alt="Order-Service-Application.png" src="img/a9e0187a4d4c4f0a.png"></li>
<li>Here you can connect to your Solace cloud broker instance to publish and subscribe events.</li>
<li>The connection parameters for the Order Service application can be captured from below : <img alt="brokerconsole_connect_creds_java.png" src="img/1e1b23a376e27f62.png"></li>
<li>Make a note of the following properties in a separate file as they will be required for the following steps: <ul>
<li>Public Endpoint</li>
<li>Message VPN<br><img alt="brokerconsole_connect_creds_java_highlighted.png" src="img/ac24f5fa0ca5bfb7.png"></li>
</ul>
<aside class="warning"><p> Just take the endpoint and message vpn details for now, the username and password are the ones you configured in the earlier step in the Event Portal.</p>
</aside>
</li>
<li>Fill in the connection details in the appropriate text box and click on the <strong>Connect to broker</strong> button</li>
<li>You should see a screen as below with the appropriate connection status : <img alt="order-service-broker-connected.png" src="img/d4d35cd6d236f44f.png"></li>
<li>Click on the <strong>Create a new basket for ordering</strong> button to simulate a new basket as below: <img alt="order-service-basket-init.png" src="img/2d3b9fd0a9148c9f.png"></li>
<li>In the background after 10–15 seconds, the basket is converted into an order and an <em>Order-Created</em> event is automatically triggered, and the status of the order is automatically updated to CREATED as below : <img alt="order-created.png" src="img/1b9f18fce6cc668c.png"></li>
<li>The <em>Order-Created</em> is published to the topic defined in the Event Portal design as below : <img alt="ep-Order-created-event.png" src="img/136b64ddd4cb1aca.png"></li>
<li>If you observe the logs closely, you will see that the broker sends back an <strong>ACK or Acknowledge</strong> for every <strong>Order-Created</strong> event that is being published. This is because we are publishing these events as <strong>Persistent</strong> events.</li>
<li>You can also verify this quickly by using the <strong>Try-Me</strong> tab.</li>
<li>Feel free to trigger a few more orders using the UI and observe the payload and topics on which the events are published. <aside class="special"><p> If you need help using the <strong>Try-me</strong> then feel free to ask any of the Solace members running the masterclass for assistance.</p>
</aside>
</li>
</ul>
<h2 is-upgraded>2. Inventory-FraudCheck-Service</h2>
<h3 is-upgraded>Introduction</h3>
<p>As Acme-Retail has been facing major challenges with fraudulent orders and realtime stock management, the stakeholders want to ensure that the system is not over committing to orders for which there is no stock. Additionally, they also want to do a fraud check on the customer and order to ensure that only legitimate orders are processed and shipped.</p>
<p>This requirement has been implemented in the <strong>Inventory-FraudCheck-Service</strong> which subscribes to each incoming <em>Order-Created</em> event and performs the inventory reservation and fraud check. Once this is completed, it triggers an <em>Order-Confirmed</em> event for further processing.</p>
<h3 is-upgraded>How to run?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Similar to how you deployed the credentials for the <strong>Order Service</strong> in the previous step, you will need to deploy the application and credentials for the <strong>Inventory-FraudCheck-Service</strong> as well.</li>
<li>In the <strong>Designer</strong> screen, enter the Acme Retail application domain</li>
<li>Click on the <strong>Inventory and FraudCheck Service</strong> and open the application</li>
<li>Navigate to the <strong>Configuration</strong> tab on the application and add credentials for the application and deploy them to the broker.</li>
</ul>
<aside class="special"><p> Make a note of the credentials (username and password) that you enter as they will be used in the following steps for deploying and running the application</p>
</aside>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>Open up a new terminal window, make sure not to close the earlier window running the <strong>Order-Service</strong></li>
<li>Navigate to the location: <strong>solace-masterclass/retail-domain/inventory-fraudcheck-service</strong></li>
<li>Run the command : <code>mvn clean install</code></li>
<li>Run the command : <code>java -jar target/inventory-fraudcheck-service-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></li>
</ul>
<aside class="special"><p> You would have used the host url and vpn name parameters in the earlier step for the <strong>Order-Service</strong>.<br> The credentials (username and password) should be the same as you set up in the broker configuration section of this application</p>
</aside>
<ul>
<li>Keep an eye out on the logs to see if the application is starting up properly as expected.</li>
</ul>
<h3 is-upgraded>Error?</h3>
<p class="image-container"><img alt="Oops.png" src="img/22223cf4a3c311b2.png"></p>
<p>Did you get an error as below complaining about the absence of a queue object :</p>
<pre><code language="language-Java" class="language-Java">2024-03-22T12:42:19.725+01:00  INFO 69425 --- [1_ReactorThread] c.s.jcsmp.impl.flow.BindRequestTask  : Client-1: Got BIND (&#39;#P2P/QUE/all-orders-placed&#39;) Error Response (503) - Unknown Queue
com.solace.messaging.PubSubPlusClientException$MissingResourceException: 503: Unknown Queue
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.createSolaceConsumer(PersistentMessageReceiverImpl.java:1359)
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.onStart(PersistentMessageReceiverImpl.java:1169)
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.startAsync(PersistentMessageReceiverImpl.java:436)
</code></pre>
<p>If you remember about Solace Queue which we discussed earlier, we differentiated them into two types :</p>
<ol type="1">
<li>Durable: Mostly created by an administrator and always exists on the broker unless explicitly deleted by an administrator</li>
<li>Non-Durable: Temporary in nature, created only by an application and its lifespan is linked to the client that created it.</li>
</ol>
<p>Since in the case of Acme Retail, it is critical that no messages are lost during application downtime and also no subscribing application should be able to delete the queue object; an architectural choice was made to use <strong>Durable - Exclusive</strong> queue configurations.</p>
<p>To fix the error encountered above, you need to create the Queue object as below :</p>
<ul>
<li>Open the <strong>Inventory and FraudCheck Service</strong> and click <strong>Advanced Subscription Setup</strong> as below : <img alt="consumer-config-inventory-service.png" src="img/ec3d3d9e015a2c9e.png"></li>
<li>Click on the <strong>Create Consumer</strong> as below and enter the following details in the popup window : <img alt="consumer-config-inventory-service-step2.png" src="img/ed15e106e66fd465.png"><ul>
<li>Name : <code>all-orders-placed</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic subscription based on your application design <img alt="inventory-serivice-subscriptions-step1.png" src="img/fdba79a668caa1c5.png"></li>
</ul>
<aside class="warning"><p> Do you recollect how Solace topic filtering and matching works? Feel free to ask any of the Solace presenters if you have any queries. You can also explore the modal window which tells you how it has derived the subscription.</p>
</aside>
<ul>
<li>Click on the <strong>Configurations</strong> tab on the left sidebar, select the environment and broker selected previously and click on the button <strong>Next:Define Event Handling</strong>.</li>
<li>In the <strong>Define Event Handling</strong> tab, you should see the consumer created in the earlier step : <img alt="inventory-service-consumer-setup-1.png" src="img/1d34d30bc5a1300f.png"></li>
<li>Click on the <strong>Next:Define Access Control</strong> button, but no action is requried on this sub-step as the credentials have already been configured for this application.</li>
<li>Click <strong>Review</strong> and then <strong>Start Promotion</strong>. This will signal Event Portal to push only the new configuration objects to the broker.</li>
<li>With the above steps, a new queue has been created with the required subscription which can now be connected to by the <strong>Inventory-FraudCheck-Service</strong></li>
</ul>
<aside class="special"><p> Make a note of the above steps as you will be creating multiple queues with similar configuration for the other applications.</p>
</aside>
<h3 is-upgraded>Retry deployment</h3>
<p>Now that the missing queue has been created with the proper subscription, restart/rerun the <strong>Inventory-FraudCheck-Service</strong> application using the same command : <code>java -jar target/inventory-fraudcheck-service-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></p>
<h3 is-upgraded>Output</h3>
<p>As you closely observe the logging being displayed on the console, you can see no events coming in from the queue. But how could that be when you clearly created multiple orders from the <strong>Order-Service</strong> ? <img alt="where-did-the-events-go.png" src="img/576ed5e325911bd7.png"></p>
<p>If you think closely, you would realize that when you created those orders, the queue <strong>all-orders-placed</strong> had not been created yet. So all the <strong>Order-created</strong> events even though they were marked as persistent and acknowledged by the broker were lost as the broker could not find an active consumer for them.</p>
<p>Now that you have created the queue, newly published orders will lie in the queue till a consumer processes and acknowledge the event.</p>
<p>Let&#39;s test out the flow again till now by building and deploying the Order-Service and observing the logs on the <strong>Inventory-FraudCheck-Service</strong> to see incoming order created events.</p>
<h3 is-upgraded>New feature enhancement</h3>
<p>For each incoming <strong>Order-Created</strong> event, an <strong>Order-Confirmed</strong> event will be published as the stock reservation and fraud check passes.</p>
<p>This <strong>Order-Confirmed</strong> needs to be subscribed by the <strong>Order Service</strong>. Follow the below steps to enable this flow :</p>
<ul>
<li>Navigate to the Designer screen and open the <strong>Order Service</strong> application.</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings : <ul>
<li>Name : <code>all-order-updates</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic <ul>
<li>You should have a subscription setup which looks like this : <img alt="order-service-all-order-updates-queue.png" src="img/2b48d02c90d5cb43.png"></li>
</ul>
</li>
</ul>
<aside class="special"><p> We have already incorporated all the subscriptions required for this exercise.</p>
</aside>
<ul>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab and push the updates to the event broker as you have done for the previous applications.</li>
<li>Publish a few more orders from the <strong>Order-Service</strong> and see it being processed in the console logs.</li>
<li>Go back to the <strong>Order-Service,</strong> and you will observe that the status of the newly created order is showing as VALIDATED as the orders are processed by the <strong>Inventory-FraudCheck-Service</strong></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Part-A: Retail Domain—Continued" duration="30">
        <p>Let us continue with the next applications in the OTC flow :</p>
<h2 is-upgraded>3. Payment Service</h2>
<p>Payment-Service-Provider (PSP) or Payment Gateway integrations are inherently complex due to error handling and transaction management, asynchronous communication, scalability, etc. Due to legacy architectural choices, Acme shop has faced considerable challenges in having a stable payment integration leading to revenue loss and customer dissatisfaction in many cases. Hence, PSP integration has been a major component of this POC for validating that Solace and EDA are a viable solution to this problem statement.</p>
<h3 is-upgraded>Introduction</h3>
<p>The Payment-Service subscribes to the <em>Order-Confirmed</em> event being published by the <strong>Inventory-Fraudcheck-Service</strong> and processes the payment integration for that order.<br> To denote that the payment processing has begun, it publishes a <em>Payment Created</em> event initially and once the payment authorization and confirmation comes in, an additional <em>Payment Updated</em> event is published.<br> The <em>Payment Created</em> event is in-turn subscribed by the <strong>Order Service</strong> for user status updates</p>
<h3 is-upgraded>How to run?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Navigate to the Designer screen and open the <strong>Payment Service</strong> application.</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings : <ul>
<li>Name : <code>all-orders-confirmed</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic <ul>
<li>You should have a subscription setup which looks like this : <img alt="payment-service-all-orders-confirmed-queue.png" src="img/c4ec20e1efaf7cde.png"></li>
</ul>
</li>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab and push the updates to the event broker as you have done for the previous applications.</li>
</ul>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>Open up a new terminal window, make sure not to close the earlier window running the earlier applications</li>
<li>Navigate to the location: <strong>solace-masterclass/retail-domain/payment-service</strong></li>
<li>Run the command : <code>mvn clean install</code></li>
<li>Run the command : <code>java -jar target/payment-service-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code> and observe the console to see what events are getting processed and subsequently produced</li>
</ul>
<aside class="special"><p> The credentials (username and password) for the Payment Service are the same as you configured on the Configuration tab for this application</p>
</aside>
<h3 is-upgraded>Testing</h3>
<p>To do a complete end-to-end test of the current flow, you can quickly publish a few more orders from the <strong>Order-Service</strong> and see the following events being produced and consumed across the three applications :</p>
<ol type="1">
<li>Order Created</li>
<li>Order Confirmed</li>
<li>Payment Created</li>
<li>Payment Updated</li>
</ol>
<p>You can also see that the status of the order in the <strong>Order Service</strong> changes from <strong>Validated</strong> to <strong>PAYMENT_PROCESSED</strong></p>
<h2 is-upgraded>4. Shipping Service</h2>
<p>Similar to the PSP and payment gateway, integrations with third-party logistics (3PL) forms an integral part of the OTC flow and is responsible for warehousing, inventory, shipping, tracking, reverse logistics etc. Considering the criticality of the use case, Acme Retail is opting to include 3PL integration as a part of the POC for the following reasons :</p>
<ol type="1">
<li>Real time updates</li>
<li>Scalability</li>
<li>Decoupling of systems</li>
<li>Fault tolerance</li>
<li>Extensibility</li>
</ol>
<h3 is-upgraded>Introduction</h3>
<p>The <strong>Shipping Service</strong> is the final leg of this POC flow. It subscribes to the <em>Payment Created</em> event, integrates with the 3PL services and publishes the <em>Shipment Created</em> and <em>Shipment Updated</em> events.<br> The <strong>Order Service</strong> subscribes to the <em>Shipment Created</em> for user status updates</p>
<h3 is-upgraded>How to run?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Navigate to the Designer screen and open the <strong>Shipping Service</strong> application.</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings : <ul>
<li>Name : <code>all-payments-confirmed</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic <ul>
<li>You should have a subscription setup which looks like this : <img alt="shipping-service-all-payments-confirmed-queue.png" src="img/8d168346eaa3103a.png"></li>
</ul>
</li>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab and push the updates to the event broker as you have done for the previous applications.</li>
</ul>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>Open up a new terminal window, make sure not to close the earlier window running the earlier applications</li>
<li>Navigate to the location: <strong>solace-masterclass/retail-domain/shipping-service</strong></li>
<li>Run the command : <code>mvn clean install</code></li>
<li>Run the command : <code>java -jar target/shipping-service-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code> and observe the console to see what events are getting processed and subsequently produced.</li>
</ul>
<aside class="special"><p> The credentials (username and password) for the Shipping Service are the same as you configured on the Runtime tab for this application</p>
</aside>
<h3 is-upgraded>Testing</h3>
<p>To do a complete end-to-end test of the current flow, you can quickly publish a few more orders from the <strong>Order-Service</strong> and see the following events being produced and consumed across the 4 applications :</p>
<ul>
<li>Order Created</li>
<li>Order Confirmed</li>
<li>Payment Created</li>
<li>Payment Updated</li>
<li>Shipment created</li>
<li>Shipment updated</li>
</ul>
<p>You can also see that the status of the order in the Order Service changes from <strong>PAYMENT_PROCESSED</strong> to <strong>SHIPPED</strong></p>
<h2 is-upgraded>Benefits realized</h2>
<p>As a result of this POC, Acme Retail has achieved a number of benefits including :</p>
<ul>
<li><strong>Improved scalability</strong>: Event-driven architectures can be more easily scaled than traditional architectures because they are loosely coupled. This means that different parts of the system can be scaled independently without affecting other parts.</li>
<li><strong>Improved resilience</strong>: Event-driven architectures are more resilient to failures than traditional architectures. This is because if one part of the system fails, it will not bring down the entire system. Other parts of the system can continue to process events and eventually catch up when the failed part comes back online.</li>
<li><strong>Improved agility</strong>: Event-driven architectures can make it easier to develop and deploy new features. This is because changes can be made to one part of the system without affecting other parts.</li>
<li><strong>Improved visibility</strong>: Event-driven architectures can provide better visibility into what is happening in the system. This is because events are a record of what has happened, and they can be used to track the progress of orders, identify errors, and audit activity.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Part-B : Banking domain" duration="45">
        <h2 is-upgraded>Use case explanation</h2>
<p>For the banking domain, we will be working with one of the major banks in the world <strong>Acme Bank</strong> which has been a leader in online banking and customer journey. They have a large customer base which leads to a humungous load of transactions.<br> As the importance of preventing fraudulent transactions and money laundering grows, Acme Bank is compelled to adhere to stringent legal and security standards. This necessitates thorough transaction monitoring across its systems to ensure compliance with regulatory mandates</p>
<p>On the roadmap to comply with these requirements, Acme Bank is currently facing the following challenges :</p>
<ul>
<li>Integration Complexity</li>
<li>Data Silos</li>
<li>Legacy Systems</li>
<li>Real time processing</li>
</ul>
<p>As a solution, Acme Bank has defined a POC to event enable account handling, transaction management and fraud detection systems. The application and event dependencies are defined as below :</p>
<ul>
<li>The <strong>Account Management</strong> application triggers off an <em>Account Applied</em> event based on user request.</li>
<li>After background processing, the flow completes with an account being opened and a corresponding <em>Account Opened</em> event being triggered.</li>
<li>The <strong>Core Banking</strong> application subscribes to the Account related events and publishes events related to various transactions (<em>Transfer</em>, <em>Withdrawal</em> and <em>Deposit</em> ) being performed on the accounts</li>
<li>The account&#39;s transaction related events are subscribed to by the <strong>Fraud Detection</strong> application which performs due diligence on these transactions and flags potential fraudulent transactions by triggering a <em>Fraud Detected</em> event</li>
<li>The <strong>Account Management</strong> application subscribes to this <em>Fraud Detected</em> event, and after background processing triggers a <em>Fraud Confirmed</em> event and suspends the corresponding account by triggering an <em>Account Suspended</em> event</li>
</ul>
<p class="image-container"><img alt="banking-domain-flowchart.png" src="img/e7ccf8ce747fc384.png"></p>
<h2 is-upgraded>1. Account Management application</h2>
<h3 is-upgraded>Introduction</h3>
<p>The <strong>Account Management</strong> application acts as the entry point for the whole flow and emulates the user experience of applying for a bank account and the background processing associated with that account. As described earlier in the overall flow, it starts with triggering an <em>Account Applied</em> followed by a corresponding <em>Account Opened</em> event. It also subscribes to other relevant Account related events namely the <em>Fraud Detected</em> event and triggers a <em>Fraud Confirmed</em> and corresponding <em>Account Suspended</em> events.</p>
<h3 is-upgraded>How to run ?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Click on the <strong>Designer</strong> button and enter the Designer screen where you should be able to see the newly imported Application Domain. <img alt="designer-app-domain-imported.png" src="img/3733556b7723cb59.png"></li>
<li>Click on the <strong>Acme Bank</strong> application domain, where you can visualise the events, applications and their interactions as below : <img alt="formatted-app-domain.png" src="img/79454e068f375e63.png"></li>
</ul>
<aside class="special"><p> Do note that the first time visualization of the events and their interactions might differ from what you see in the screenshot.<br> You can reorder the objects as per your preference</p>
</aside>
<ul>
<li>Click on the <strong>Account Management</strong>, and then on the <strong>Open Application</strong> which pops up as below : <img alt="edit-account-management-1.png" src="img/31c63284d7f8e730.png"></li>
<li>The <strong>Account Management</strong> application screen displays you the various events that are published and subscribed by this version of the application. <img alt="editing-acc-management-1.png" src="img/f1c51a08f82a7a94.png"></li>
<li>Click on the <strong>Configuration</strong> tab on the left of the sidebar as below. This opens up the configuration screen, click on the <strong>Create Configurations</strong> button as shown: <img alt="configuring-acc-management-1.png" src="img/959dd0f47ac4d4c5.png"></li>
<li>A modal window opens up as below, first select the environment and the broker that you have created earlier and click on the Next:Define Event Handling button : <img alt="configuring-acc-mgt-2.png" src="img/1d555972ec28d8c2.png"></li>
<li>For now, we are not configuring any consumers (or subscriptions) for this application, so click on the Next: Define Access Control button directly. <img alt="configuring-acc-mgt-3.png" src="img/c1b077670466900f.png"></li>
<li>For authentication, select the <strong>Basic</strong> access type and enter a client username and password of your choice as below. Make sure to keep a note of these credentials as they will be required in the following steps. <img alt="configuring-acc-mgt-3.png" src="img/c980ff531b4a8c75.png"></li>
<li>Review the configuration in both the Define Event Handling and Define Access Control tabs and if everything looks as expected, click Start Promotion as below : <img alt="configuring-acc-mgt-5.png" src="img/c67f4a57cc07b0dc.png"></li>
<li>An intermediate screen is shown as below indicating some design mismatches, but you can safely ignore them for now and click on the Preview Promotion button as below : <img alt="configuring-acc-mgt-6.png" src="img/b7815a81d5dd32e1.png"></li>
<li>The final promotion preview is shown as below, detailing the various configuration objects that will be created on the broker. Click on the Promote button as shown : <img alt="configuring-acc-mgt-7.png" src="img/7043009cb35752cf.png"></li>
<li>Once the deployment is completed, you can see the deployed application version on the broker as below : <img alt="acc-mgt-deployed.png" src="img/b349374745c925ad.png"></li>
</ul>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>In the codespace terminal, create a new terminal window by clicking on the <strong>+</strong> icon on the terminal pane</li>
<li>Navigate to the directory: <strong>solace-masterclass/retail-domain/order-service</strong></li>
<li>Run the command : <code>mvn clean spring-boot:run</code></li>
<li>Once the application is up and running, open the application using the url that is shown in the popup within the codespace.</li>
<li>You should see a page which looks like this : <img alt="Account-management-application.png" src="img/8c96cf3d8e76bd3f.png"></li>
<li>Here you can connect to your Solace cloud broker instance to publish and subscribe events.</li>
<li>The connection parameters for the Account management application can be captured from below : <img alt="brokerconsole_connect_creds_java.png" src="img/1e1b23a376e27f62.png"></li>
<li>Make a note of the following properties in a separate file as they will be required for the following steps: <ul>
<li>Public Endpoint</li>
<li>Message VPN<br><img alt="brokerconsole_connect_creds_java_highlighted.png" src="img/ac24f5fa0ca5bfb7.png"></li>
</ul>
</li>
<li>The credentials (username and password) were configured in the previous step.</li>
<li>Fill in the connection details in the appropriate text box and click on the <strong>Connect to broker</strong> button</li>
<li>You should see a screen as below with the appropriate connection status : <img alt="acnt-mgt-broker-connected.png" src="img/d2fcad0a712c0a03.png"></li>
<li>Click on the <strong>Apply for a new Acme Bank account</strong> to generate a new account application and trigger an <strong>Account applied</strong> event and see a screen as below : <img alt="acnt-mgt-account-applied.png" src="img/2b713a65c2d9e031.png"></li>
<li>In the background after 10 seconds, a second <strong>Account opened</strong> event is automatically triggered and the status of the new account is automatically updated to OPENED as below : <img alt="acnt-mgt-account-opened.png" src="img/168686236c5147c3.png"></li>
<li>All the account related events are published to the topics defined in the Event Portal design as below : <img alt="ep-account-events.png" src="img/f35b9260edffe9da.png"></li>
<li>You can also verify this quickly by using the <strong>Try-Me</strong> tab. How to do this would have been shown in the earlier half of the day when we discussed the Solace Broker features.</li>
</ul>
<aside class="warning"><p> If you need help using the <strong>Try-me</strong> then feel free to ask any of the Solace members running the masterclass for assistance.</p>
</aside>
<h2 is-upgraded>2. Core Banking</h2>
<h3 is-upgraded>Introduction</h3>
<p>The Core Banking application is responsible for the execution of all the transactions being performed on the bank accounts like transfers, deposits and withdrawals. The Core Banking Application randomly generates the above transactions on all the accounts which are active.</p>
<h3 is-upgraded>How to run?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Similar to how you deployed the credentials for the <strong>Account Management</strong> in the previous step, you will need to deploy the application and credentials for the <strong>Core Banking</strong> as well.</li>
<li>In the <strong>Designer</strong> screen, enter the Acme Bank application domain</li>
<li>Click on the <strong>Core Banking</strong> and open the application</li>
<li>Navigate to the <strong>Configuration</strong> tab on the application and add credentials for the application and deploy them to the broker.</li>
</ul>
<aside class="special"><p> Make a note of the credentials (username and password) that you enter as they will be used in the following steps for deploying and running the application</p>
</aside>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>Open up a new terminal window, make sure not to close the earlier window running the Account Management application</li>
<li>Navigate to the directory: <strong>solace-masterclass/banking-domain/core-banking</strong></li>
<li>Run the command : <code>mvn clean install</code></li>
<li>Run the command : <code>java -jar target/core-banking-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></li>
</ul>
<aside class="special"><p> You would have used the host url and vpn name parameters in the earlier step for the <strong>Account Management</strong>.<br> The credentials (username and password) should be the same as you set up in the broker configuration section of this application</p>
</aside>
<ul>
<li>Keep an eye out on the logs to see if the application is starting up properly as expected.</li>
</ul>
<h3 is-upgraded>Error?</h3>
<p class="image-container"><img alt="Oops.png" src="img/22223cf4a3c311b2.png"></p>
<p>Did you get an error as below complaining about the absence of a queue object :</p>
<pre><code language="language-Java" class="language-Java">2024-03-22T12:42:19.725+01:00  INFO 69425 --- [1_ReactorThread] c.s.jcsmp.impl.flow.BindRequestTask  : Client-1: Got BIND (&#39;#P2P/QUE/accounts-opened&#39;) Error Response (503) - Unknown Queue
com.solace.messaging.PubSubPlusClientException$MissingResourceException: 503: Unknown Queue
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.createSolaceConsumer(PersistentMessageReceiverImpl.java:1359)
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.onStart(PersistentMessageReceiverImpl.java:1169)
at com.solace.messaging.receiver.PersistentMessageReceiverImpl.startAsync(PersistentMessageReceiverImpl.java:436)
</code></pre>
<p>If you remember about Solace Queue which we discussed earlier, we differentiated them into 2 types :</p>
<ol type="1">
<li>Durable: Mostly created by an administrator and always exists on the broker unless explicitly deleted by an administrator</li>
<li>Non-Durable: Temporary in nature, created only by an application and its lifespan is linked to the client that created it.</li>
</ol>
<p>Given the criticality for Acme Bank to maintain message integrity during application downtime, alongside the imperative that subscribing applications cannot delete queue objects, an architectural decision was made to implement <strong>Durable-Exclusive</strong> queue configurations.</p>
<p>To fix the error encountered above, you need to manually create the Queue object as below :</p>
<ul>
<li>Open the <strong>Core Banking</strong> application and click <strong>Advanced Subscription Setup</strong> as below : : <img alt="consumer-config-core-banking.png" src="img/da22874e0b3e867.png"></li>
<li>Click on the <strong>Create Consumer</strong> as below and enter the following details in the popup window : <img alt="consumer-config-core-banking-1.png" src="img/302ac7e180c3feee.png"><ul>
<li>Name : <code>accounts-opened</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic subscription based on your application design</li>
<li>Event Portal identifies multiple possible subscriptions for this consumer, so ensure you select the correct one as below : <img alt="core-banking-subscriptions-1.png" src="img/50bd548b0b7e742f.png"></li>
</ul>
<aside class="warning"><p> Do you recollect how Solace topic filtering and matching works? Feel free to ask any of the Solace presenters if you have any queries. You can also explore the modal window which tells you how it has derived the subscription.</p>
</aside>
<ul>
<li>Click on the <strong>Configurations</strong> tab on the left sidebar, select the environment and broker selected previously and click on the button <strong>Next:Define Event Handling</strong></li>
<li>In the <strong>Define Event Handling</strong> tab, you should see the consumer created in the earlier step : <img alt="core-banking-consumer-setup-1.png" src="img/4a56bcae47f91a53.png"></li>
<li>Click on the <strong>Next:Define Access Control</strong> button, but no action is requried on this sub-step as the credentials have already been configured for this application.</li>
<li>Click <strong>Review</strong> and then <strong>Start Promotion</strong>. This will signal Event Portal to push only the new configuration objects to the broker.</li>
<li>With the above steps, a new queue has been created with the required subscription which can now be connected to by the <strong>Core-Banking</strong></li>
</ul>
<aside class="special"><p> Make a note of the above steps as you will be creating multiple queues with similar configuration for the other applications.</p>
</aside>
<h3 is-upgraded>Retry deployment</h3>
<p>Now that the missing queue has been created with the proper subscription, restart/rerun the <strong>Core Banking</strong> application using the same command : <code>java -jar target/core-banking-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></p>
<h3 is-upgraded>Output</h3>
<p>As you closely observe the logging being displayed on the console, you can see no events coming in from the queue. But how could that be when you clearly created multiple orders from the <strong>Account Management Application</strong> ? <img alt="where-did-the-events-go.png" src="img/576ed5e325911bd7.png"></p>
<p>If you think closely, you would realize that when you created those orders the queue <strong>accounts-opened</strong> had not been created yet. So all the <strong>Account Opened</strong> events even though they were marked as persistent and acknowledged by the broker were lost as the broker could not find an active consumer for them.</p>
<p>Now that you have created the queue, newly published orders will lie in the queue till a consumer processes and acknowledge the event.</p>
<p>So trigger a few more Account creation requests from the <strong>Account Management Application</strong> and see the <strong>Account Opened</strong> events being triggered. Once this happens, the <strong>Core-Banking</strong> application should receive those events and start publishing transaction events for the active accounts.</p>
<h2 is-upgraded>3. Fraud Detection</h2>
<p>As the need to prevent fraudulent transactions and money laundering intensifies, Acme Bank is obligated to adhere to stringent legal and security standards. This entails conducting comprehensive transaction checks across its system to ensure compliance with regulatory mandates.</p>
<p>This realtime monitoring of transactions is being handled by the <strong>Fraud Detection</strong> service. It subscribes to all the transaction events being published by the <strong>Core Banking</strong> application and flags suspicious/potentially fraudulent transactions by publishing a <em>Fraud Detected</em> event.</p>
<h3 is-upgraded>How to run?</h3>
<h4 is-upgraded><strong>Part 1 : Broker Configuration</strong></h4>
<ul>
<li>Navigate to the Designer screen and open the <strong>Fraud Detection</strong> application.</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings : <ul>
<li>Name : <code>all-transactions</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic <ul>
<li>You should have a subscription setup which looks like this : <img alt="fraud-detection-subscriptions.png" src="img/6e02f3eb38e40937.png"></li>
</ul>
</li>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab, create configurations and credentials for pushing to the event broker as you have done for the previous applications.</li>
<li>Now that you have created the configuration for feeding the <strong>Fraud Detection</strong> service, we can build and start the application.</li>
</ul>
<h4 is-upgraded><strong>Part 2 : Application build and deployment</strong></h4>
<ul>
<li>Open up a new terminal window, make sure not to close the earlier window running the earlier applications</li>
<li>Navigate to the directory: <strong>solace-masterclass/banking-domain/fraud-detection</strong></li>
<li>Run the command : <code>mvn clean install</code></li>
<li>Run the command : <code>java -jar target/fraud-detection-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></li>
</ul>
<h3 is-upgraded>Testing and output</h3>
<ul>
<li>As the application starts, you should be able to see various transaction events like <em>Transfers</em>, <em>Deposit</em> and <em>Withdrawals</em> being published on the active accounts.</li>
<li>The <strong>Fraud Detection</strong> application will start flagging potential fraudulent transactions as per its business logic.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Part-B: Banking domain-Continued" duration="25">
        <h2 is-upgraded>4. Completing the flow</h2>
<p>Event-Driven Architecture enables modular, iterative development, and fosters innovation by providing a scalable, resilient, and flexible framework for building modern software systems. By embracing EDA principles and practices, organizations can drive agility, responsiveness, and innovation in their software development processes.</p>
<p>Till now, we have :</p>
<ol type="1">
<li>Opened new accounts</li>
<li>Performed transactions on these active accounts</li>
<li>Performed fraud detection checks on these transactions and flagged suspicious transactions</li>
</ol>
<p>The next steps are performing a validation of those suspicious transactions and taking action on the linked accounts. Let&#39;s start with implementing this feature flow across multiple applications in a modular fashion :</p>
<h3 is-upgraded>4.1 Account Management application</h3>
<p>The <strong>Account Management</strong> application subscribes to the <em>Fraud Detected</em> event and validates if the transaction is actually fraudulent. If found fraudulent, a corresponding <em>Fraud Confirmed</em> event is triggered and the linked account is suspended by publishing an <em>Account Suspended</em> event.</p>
<ul>
<li>Start with creating a new queue for subscribing to the <em>Fraud Detected</em> event</li>
<li>Navigate to the Designer screen and open the <strong>Account Management</strong> application.</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings :<ul>
<li>Name : <code>fraud-detected-events</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic<ul>
<li>You should have a subscription setup which looks like this : <img alt="acnt-mgt-fraud-detected-queue-config.png" src="img/4cef3c6c54041903.png"></li>
</ul>
</li>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab and push the updates to the event broker as you have done for the previous applications.</li>
<li>Navigate to the folder : <strong>solace-masterclass/banking-domain/account-management</strong></li>
</ul>
<aside class="warning"><p> If you need any assistance in this, please feel free to reach out to the Solace instructors nearby.</p>
</aside>
<ul>
<li>Open the file named <strong>com.solace.acme.bank.accountmanagement.service.SolaceEventPublisher.java</strong> in the IDE project : <ul>
<li>Add the following code block in the method <strong>connectToBroker</strong> : <pre><code language="language-Java" class="language-Java">    final PersistentMessageReceiver fraudDetectedEventReceiver = messagingService.createPersistentMessageReceiverBuilder().build(Queue.durableExclusiveQueue(configProperties.getSolaceFraudDetectedEventQueue()));
    fraudDetectedEventReceiver.setReceiveFailureListener(failedReceiveEvent -&gt; log.error(&#34;### FAILED RECEIVE EVENT &#34; + failedReceiveEvent));
    fraudDetectedEventReceiver.start();
    fraudDetectedEventReceiver.receiveAsync(buildFraudDetectedEventHandler(fraudDetectedEventReceiver));
</code></pre>
<aside class="special"><p> This code snippet builds a subscriber which will receive persistent messages published to the queue <strong>fraud-detected-events</strong></p>
</aside>
<ul>
<li>Introduce the below new methods in the SolaceEventPublisher.java file : <pre><code language="language-Java" class="language-Java">      private MessageReceiver.MessageHandler buildFraudDetectedEventHandler(PersistentMessageReceiver fraudDetectedEventReceiver) {
          return (inboundMessage -&gt; {
              try {
                  final String inboundTopic = inboundMessage.getDestinationName();
                  log.info(&#34;Processing message on incoming topic :{} with payload:{}&#34;, inboundTopic, inboundMessage.getPayloadAsString());
                  boolean eventProcessed = fraudService.processFraudDetectedEvent(inboundMessage.getPayloadAsString());
                  if (eventProcessed) {
                      fraudDetectedEventReceiver.ack(inboundMessage);
                  }
              } catch (RuntimeException runtimeException) {
                  log.error(&#34;Runtime exception encountered while processing incoming event payload :{} on topic:{}. Error is :&#34;, inboundMessage.getPayloadAsString(), inboundMessage.getDestinationName(), runtimeException);
              }
          });
      }
</code></pre>
<aside class="special"><p> This defines a handler which processes the incoming event from the <strong>fraud-detected-events</strong> queue.</p>
</aside>
</li>
</ul>
</li>
</ul>
</li>
<li>Open the file named <strong>com.solace.acme.bank.accountmanagement.service.FraudService.java</strong> in the same project : <ul>
<li>Introduce the following new method as below in the file : <pre><code language="language-Java" class="language-Java">      public boolean processFraudDetectedEvent(final String incomingFraudDetectedEventJson) {
        try {
            final FraudDetected fraudDetectedEvent = objectMapper.readValue(incomingFraudDetectedEventJson, FraudDetected.class);

            boolean isFraud = random.nextBoolean();
            if (isFraud) {
                log.info(&#34;Flagging potential fraud as confirmed :{}&#34;, fraudDetectedEvent);
                createAndPublishFraudConfirmedEvent(fraudDetectedEvent);
                accountService.processAccountSuspensionRequest(fraudDetectedEvent.getAccountNum());
            }
            return true;
        } catch (JsonProcessingException jsonProcessingException) {
            log.error(&#34;Error encountered while processing FraudDetected event:{}, exception:&#34;, incomingFraudDetectedEventJson, jsonProcessingException);
            return false;
        }
      }
</code></pre>
<aside class="special"><p> This code snippet contains the business logic for processing the Fraud Detected event payload queue.</p>
</aside>
</li>
</ul>
</li>
<li>Open the file named <strong>com.solace.acme.bank.accountmanagement.service.AccountService.java</strong> in the same project : <ul>
<li>Introduce the following method in the class : <pre><code language="language-Java" class="language-Java">    public void processAccountSuspensionRequest(final String accountNumber) {
      log.info(&#34;Processing account suspension&#34;);
      final AccountAction accountSuspendedAction = createAccountSuspendedEventPayload(accountNumber);
      solaceEventPublisher.publishAccountSuspendedEvent(accountSuspendedAction);
      Account account = AccountsList.getInstance().getAccountsList().get(accountNumber);
      account.setCurrentStatus(Account.Status.SUSPENDED);
      account.setComment(&#34;Account suspended due to potential suspicious/fraudulent transaction(s)&#34;);
      AccountsList.getInstance().getAccountsList().put(accountNumber, account);
    }
</code></pre>
<aside class="special"><p> This code snippet contains the business logic for instantiating and publishing an <em>Account Suspended</em> event in response to the <em>Fraud Detected</em> transaction</p>
</aside>
</li>
</ul>
</li>
</ul>
<h3 is-upgraded>4.2 Core Banking</h3>
<p>The <em>Account Suspended</em> event published in the previous step is subscribed to by the <strong>Core Banking</strong> application which stops all transactions on that account number immediately. *</p>
<ul>
<li>Start with creating a new queue for subscribing to the <em>Account Suspended</em> event</li>
<li>In the <strong>Advanced Subscription Setup</strong> tab, create a new consumer with the below settings : <ul>
<li>Name : <code>accounts-suspended</code></li>
<li>Type : Solace Event Queue</li>
</ul>
</li>
<li>Clicking on the <strong>+</strong> symbol for the subscriptions opens up a modal window offering you a pre-selected topic <ul>
<li>You should have a subscription setup which looks like this : <img alt="core-banking-account-suspended-consumer.png" src="img/1371b2120bf89799.png"></li>
</ul>
</li>
<li>Once the consumer is created, navigate to the <strong>Configuration</strong> tab and push the updates to the event broker as you have done for the previous applications.</li>
<li>Navigate to the location :<strong>solace-masterclass/banking-domain/core-banking</strong></li>
</ul>
<aside class="warning"><p> If you need any assistance in this, please feel free to reach out to the Solace instructors nearby.</p>
</aside>
<ul>
<li>Open the file <strong>com.solace.acme.bank.corebanking.service.SolaceEventHandler.java</strong> in the project :<ul>
<li>Add in the following code snippet in the <strong>connectAndConfigureConsumers</strong> method :<pre><code language="language-Java" class="language-Java">    final PersistentMessageReceiver accountSuspendedEventReceiver = messagingService.createPersistentMessageReceiverBuilder().build(Queue.durableExclusiveQueue(configProperties.getAccountsSuspendedQueueName()));
    accountSuspendedEventReceiver.setReceiveFailureListener(failedReceiveEvent -&gt; System.out.println(&#34;### FAILED RECEIVE EVENT &#34; + failedReceiveEvent));
    accountSuspendedEventReceiver.start();
    accountSuspendedEventReceiver.receiveAsync(buildAccountsSuspendedEventHandler(accountSuspendedEventReceiver)); 
</code></pre>
<aside class="special"><p> This code snippet builds a subscriber which will receive persistent messages published to the queue <strong>accounts-suspended</strong></p>
</aside>
</li>
<li>Add in the following method in the same file :<pre><code language="language-Java" class="language-Java">    private MessageReceiver.MessageHandler buildAccountsSuspendedEventHandler(PersistentMessageReceiver accountOpenedEventReceiver) {
      return (inboundMessage -&gt; {
          try {
              final String inboundTopic = inboundMessage.getDestinationName();
              log.info(&#34;Processing message on incoming topic :{} with payload:{}&#34;, inboundTopic, inboundMessage.getPayloadAsString());
              boolean eventProcessed = accountsEventProcessor.processAccountSuspendedEvent(inboundMessage.getPayloadAsString());
              if (eventProcessed) {
                  accountOpenedEventReceiver.ack(inboundMessage);
              }
          } catch (RuntimeException runtimeException) {
              log.error(&#34;Runtime exception encountered while processing incoming event payload :{} on topic:{}. Error is :&#34;,
                      inboundMessage.getPayloadAsString(), inboundMessage.getDestinationName(), runtimeException);
          }
      });
    }
</code></pre>
<aside class="special"><p> This code snippet builds a handler for processing the events attracted to the queue <strong>accounts-suspended</strong></p>
</aside>
</li>
</ul>
</li>
<li>Open the file <strong>com.solace.acme.bank.corebanking.service.AccountsEventProcessor.java</strong> in the same project :<ul>
<li>Add in the following method in the file : <pre><code language="language-Java" class="language-Java">    public boolean processAccountSuspendedEvent(final String accountSuspendedActionEventPayload) {
        try {
            AccountAction accountSuspendedEvent = objectMapper.readValue(accountSuspendedActionEventPayload, AccountAction.class);
            Account suspendedAccount = Account.builder().accountNumber(accountSuspendedEvent.getAccountNum()).currentStatus(Account.Status.SUSPENDED).build();
            AccountsList.getInstance().getAccountsList().put(suspendedAccount.getAccountNumber(), suspendedAccount);
            log.info(&#34;After processing the updated map is :{}&#34;, AccountsList.getInstance().getAccountsList());
            return true;
        } catch (JsonProcessingException jsonProcessingException) {
            log.error(&#34;Error encountered while processing AccountOpened event:{}, exception:&#34;, accountSuspendedActionEventPayload, jsonProcessingException);
            return false;
        }
   }
</code></pre>
<aside class="special"><p> This code snippet implements the business logic for handling the suspension of an account</p>
</aside>
</li>
</ul>
</li>
</ul>
<h3 is-upgraded>4.3 Testing the flow</h3>
<ul>
<li>In the terminal where you were building the <strong>Account-Management</strong> application, stop the application (if running) and run the command  : <code>mvn clean spring-boot:run</code></li>
<li>In the terminal where you were building the <strong>Core-Banking</strong> application, stop the application (if running) run the commands : <ul>
<li><code>mvn clean install</code></li>
<li><code>java -jar target/core-banking-0.0.1-SNAPSHOT.jar -h HOST_URL -v VPN-NAME -u USER_NAME -p PASSWORD</code></li>
</ul>
</li>
<li>Make sure that the <strong>Fraud-Detection</strong> service is also running.</li>
<li>Start with a clean flow and kick off the flow by creating multiple new accounts in the <strong>Account Management</strong> application</li>
<li>As the accounts get confirmed, transactions will start flowing through the <strong>Core-Banking</strong> and <strong>Fraud-Detection</strong> applications.</li>
<li>The <strong>Fraud-Detection</strong> application will flag some of these transactions as fraudulent</li>
<li>The <strong>Account Management</strong> will verify the report of these fraudulent transactions and where applicable will suspend the linked accounts, and you can see the status of these accounts being updated in the accounts&#39; table.</li>
<li>Once the accounts are suspended, the <strong>Core-Banking</strong> application will not allow transactions on these accounts</li>
</ul>
<h2 is-upgraded>Benefits realized</h2>
<p>As a result of this POC, Acme Bank has achieved a number of benefits including :</p>
<ul>
<li><strong>Improved Efficiency</strong>: By automating tasks and streamlining processes, event-driven architectures can help banks to improve efficiency and reduce costs. For example, in the diagram you sent, the event of an account being applied for could trigger a series of automated tasks, such as verifying the applicant&#39;s identity and running a credit check. This would eliminate the need for manual intervention and could significantly speed up the account opening process.</li>
<li><strong>Enhanced Customer Experience</strong>: Event-driven architectures can also help banks to improve the customer experience. For example, if a customer deposits a check, the bank could use an event-driven architecture to send them a notification that the deposit has been received and credited to their account. This would provide customers with real-time information about their accounts and help to improve their overall satisfaction with the bank.</li>
<li><strong>Reduced Risk</strong>: Event-driven architectures can also help banks to reduce risk. For example, in the diagram you sent, the event of a fraud attempt could trigger a series of automated actions, such as blocking the transaction and notifying the customer. This would help to prevent fraudulent transactions from being completed and could save the bank money.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Takeaways and benefits" duration="5">
        <p>Below are some of the key takeaways from this masterclass :</p>
<ul>
<li><strong>Understanding Event-Driven Architecture (EDA)</strong>: Gain insights into the principles, patterns, and benefits of event-driven architecture, and learn how it enables organizations to build scalable, resilient, and responsive systems.</li>
<li><strong>Hands-on Experience with Solace</strong>:<ul>
<li>Learn how to set up and configure Solace messaging infrastructure to support event-driven applications.</li>
<li>Explore Solace&#39;s features and capabilities, including message routing, topic-based subscriptions, and event-driven integration.</li>
</ul>
</li>
<li>Practical Application Development:<ul>
<li>Acquire practical skills in designing, developing, and testing event-driven applications using Solace messaging.</li>
<li>Understand the end-to-end event flow and learn how to implement business logic within event-driven microservices.</li>
</ul>
</li>
<li>Unlocking Business Value with EDA and Solace:<ul>
<li>Discover the business benefits of adopting event-driven architecture and leveraging Solace messaging for various use cases.</li>
<li>Learn how EDA and Solace enable organizations to innovate faster, respond to market changes more effectively, and deliver superior customer experiences.</li>
</ul>
</li>
</ul>
<p class="image-container"><img alt="Soly Image Caption" src="img/44f356558033e250.gif"></p>
<p>Thanks for participating in this masterclass! Let us know what you thought in the <a href="https://solace.community/" target="_blank">Solace Community Forum</a>! If you found any issues along the way, we&#39;d appreciate it if you&#39;d raise them by clicking the Report a mistake button at the bottom left of this Codelab.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Appendix and references" duration="1">
        <ul>
<li>Link for the Solace Cloud Account: <a href="https://console.solace.cloud/home?login=true" target="_blank">Solace Cloud Account</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
